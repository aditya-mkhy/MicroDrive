# MicroDrive

**MicroDrive** turns an **ESP32-CAM with built-in SD card slot** into your own **secure remote drive**.  
Files are encrypted on your PC, relayed through your EC2 server using **mutual TLS**, and stored as encrypted blobs on the ESP32 SD card.  
No cloudâ€¦ no third-partyâ€¦ **your data stays yours**.

> **Who is this for?**  
> MicroDrive is for **developers, hackers, and privacy-focused users** who want full control over remote file storage using cheap hardware â€” **without trusting cloud providers**.

<br>


## Features

-  **ESP32-CAM as remote storage** (built-in SD slot)  
-  **End-to-end AES-256-GCM encryption** (files encrypted on PC only)  
-  **Mutual TLS (mTLS)** between PC â†” EC2 â†” ESP32  
-  **Threaded relay server** (PC â†” ESP32 communication)  
-  Remote file operations:
  - `ls`, `cd`, `cwd`, `rm`, `mkdir`, `rmdir`
  - `put` (upload + encrypt)
  - `get` (download + decrypt)
-  Upload/Download progress bar (speed, ETA, MB/s)
-  Works over the internet with just an EC2 server  
-  Clean SD access with safe mounts & error logging  
-  Certificates auto-generated via `make_certs.py`  

<br>


## Project Structure

```
MicroDrive/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ server.py          # Relay server (TLS + client cert validation)
â”‚   â””â”€â”€ certs/             # Server certs (generated by make_certs.py)
â”‚
â”œâ”€â”€ pc/
â”‚   â”œâ”€â”€ admin.py           # PC client (TLS + encryption + commands)
â”‚   â”œâ”€â”€ crypto.py          # AES-256-GCM encryption/decryption
â”‚   â”œâ”€â”€ network.py         # Framing, TLS logic
â”‚   â”œâ”€â”€ util.py            # Logging, parse_command, format_size, etc. tools
â”‚   â”œâ”€â”€ certs/             # PC-side certs
â”‚   â””â”€â”€ requirements.txt   # pip dependencies
â”‚
â”œâ”€â”€ esp32/
â”‚   â”œâ”€â”€ main.py            # ESP32 MicroPython client
â”‚   â”œâ”€â”€ drive.py           # SD card logic + path utilities
â”‚   â”œâ”€â”€ util.py            # Logging, time, WiFi helpers
â”‚   â””â”€â”€ certs.py            # ESP32 client certs (hex form)
â”‚
â”œâ”€â”€ make_certs.py          # Auto-generate server + PC + ESP32 certificates
â””â”€â”€ README.md              # (this file)
```

<br>


## Requirements

### âœ” ESP32-CAM MicroPython Firmware
Download from official MicroPython website:

âž¡ https://micropython.org/download/ESP32_GENERIC/

Flash it using esptool or Thonny.

<br>


### âœ” Thonny IDE
Recommended for uploading and testing MicroPython scripts to ESP32:

âž¡ https://thonny.org/

<br>


### âœ” Python 3 (PC client)
Install PC dependencies:

```bash
cd pc
pip install -r requirements.txt
```

<br>


## Certificate Setup (Auto-Generated)

Run this once from repo root:

```bash
python3 make_certs.py
```

This automatically generates:

- **CA** â†’ `ca_cert.pem`
- **Server cert + key** â†’ placed into `server/certs/`
- **PC client cert + key** â†’ placed into `pc/certs/`
- **ESP32 client cert + key** â†’ placed into `esp32/certs.py`

ESP32 certs are converted in **DER + HEX** form for MicroPython.

<br>


## Running the Relay Server (EC2)

On your AWS EC2:

```bash
cd server
python3 server.py 9000
```

- Requires: `server_cert.pem`, `server_key.pem`, `ca_cert.pem`
- Server performs **mutual TLS authentication**
- Validates **CN=pc-client** and **CN=esp32-client**

<br>


## Running the PC Client

```bash
cd pc
python3 admin.py <EC2-IP> 9000
```

You get an interactive shell:

```
(microdrive) sd:\ ~ ls
(microdrive) sd:\ ~ put "c:\video.mp4" "blog.mp4" -p <passwd>
(microdrive) sd:\ ~ get "c:\blog.mp4" "blog.mp4" -p <passwd>
(microdrive) sd:\ ~ mkdir Videos
(microdrive) sd:\ ~ cd Videos
(microdrive) sd:\Videos ~ rm blog.mp4
(microdrive) sd:\ ~ rmdir Videos
```

### Features

- AES-256-GCM encryption locally
- TLS client certificate authentication
- Progress bars with speed + time left
- Remote file tree navigation

<br>


## Running ESP32 Client (MicroPython)

Upload `esp32/` folder to your ESP32-CAM using **Thonny**.

What it does:

- Connects to WiFi
- Loads certs
- Performs TLS handshake with EC2 server  
- Mounts SD card  
- Executes remote commands (`put`, `get`, `ls`, `rm`, `mkdir`, `rmdir`)  

All file data remains encrypted on SD card.

<br>


## ðŸ”’ Security Model

| Layer | Protection |
|-------|------------|
| PC â†” EC2 | TLS with client certificate |
| ESP32 â†” EC2 | TLS with client certificate (working, tested) |
| File Content | AES-256-GCM encryption (PC only) |
| EC2 Server | Acts only as a relay; **never sees plaintext** |
| SD Card | Stores ciphertext only |

Even if EC2 or ESP32 SD card is compromised â€” files remain unreadable.

<br>


## Notes

- MicroDrive works even if ESP32 TLS is limited â€” AES encryption protects files.  
- Use **NTP** on ESP32 to fix timestamps.  
- ESP32â€™s built-in SD slot works perfectly with MicroPythonâ€™s `machine.SDCard(slot=1)`.

<br>


## Credits

Made with love & caffeine by the project author.  
ESP32 + MicroPython + Cryptography = ðŸ”¥
